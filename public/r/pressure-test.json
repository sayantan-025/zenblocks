{
  "name": "pressure-test",
  "type": "registry:block",
  "dependencies": [
    "framer-motion"
  ],
  "registryDependencies": [],
  "files": [
    {
      "type": "registry:component",
      "path": "components/zenblocks/pressure-test.tsx",
      "target": "components/zenblocks/pressure-test.tsx",
      "content": "\"use client\";\r\n\r\nimport React, {\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n  useMemo,\r\n  useCallback,\r\n} from \"react\";\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/*                                   TYPES                                    */\r\n/* -------------------------------------------------------------------------- */\r\n\r\ninterface Vec2 {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\ninterface PressureTestProps {\r\n  text?: string;\r\n  fontFamily?: string;\r\n  fontUrl?: string;\r\n  width?: boolean;\r\n  weight?: boolean;\r\n  italic?: boolean;\r\n  alpha?: boolean;\r\n  flex?: boolean;\r\n  stroke?: boolean;\r\n  scale?: boolean;\r\n  textColor?: string;\r\n  strokeColor?: string;\r\n  strokeWidth?: number;\r\n  className?: string;\r\n  minFontSize?: number;\r\n  justify?: \"start\" | \"center\" | \"end\" | \"between\";\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/*                                  HELPERS                                   */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nconst dist = (a: Vec2, b: Vec2): number => {\r\n  const dx = b.x - a.x;\r\n  const dy = b.y - a.y;\r\n  return Math.sqrt(dx * dx + dy * dy);\r\n};\r\n\r\nconst getAttr = (\r\n  distance: number,\r\n  maxDist: number,\r\n  minVal: number,\r\n  maxVal: number\r\n): number => {\r\n  const val = maxVal - Math.abs((maxVal * distance) / maxDist);\r\n  return Math.max(minVal, val + minVal);\r\n};\r\n\r\nfunction debounce<T extends (...args: never[]) => void>(\r\n  fn: T,\r\n  delay: number\r\n): (...args: Parameters<T>) => void {\r\n  let timeoutId: ReturnType<typeof setTimeout> | undefined;\r\n\r\n  return (...args: Parameters<T>) => {\r\n    if (timeoutId) clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => fn(...args), delay);\r\n  };\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/*                               COMPONENT                                    */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nconst PressureTest: React.FC<PressureTestProps> = ({\r\n  text = \"Compressa\",\r\n  fontFamily = \"Compressa VF\",\r\n  fontUrl = \"https://res.cloudinary.com/dr6lvwubh/raw/upload/v1529908256/CompressaPRO-GX.woff2\",\r\n  width = true,\r\n  weight = true,\r\n  italic = true,\r\n  alpha = false,\r\n  flex = true,\r\n  stroke = false,\r\n  scale = false,\r\n  textColor,\r\n  strokeColor,\r\n  strokeWidth = 2,\r\n  className = \"\",\r\n  minFontSize = 24,\r\n  justify = \"between\",\r\n}) => {\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const titleRef = useRef<HTMLHeadingElement>(null);\r\n  const spansRef = useRef<Array<HTMLSpanElement | null>>([]);\r\n\r\n  const mouseRef = useRef<Vec2>({ x: 0, y: 0 });\r\n  const cursorRef = useRef<Vec2>({ x: 0, y: 0 });\r\n\r\n  const [fontSize, setFontSize] = useState(minFontSize);\r\n  const [scaleY, setScaleY] = useState(1);\r\n  const [lineHeight, setLineHeight] = useState(1);\r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  const chars = useMemo(() => text.split(\"\"), [text]);\r\n\r\n  /* ------------------------------ MOUNT ----------------------------------- */\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  /* ------------------------------ POINTER -------------------------------- */\r\n\r\n  useEffect(() => {\r\n    if (!mounted) return;\r\n\r\n    const onMouseMove = (e: MouseEvent) => {\r\n      cursorRef.current.x = e.clientX;\r\n      cursorRef.current.y = e.clientY;\r\n    };\r\n\r\n    const onTouchMove = (e: TouchEvent) => {\r\n      const t = e.touches[0];\r\n      cursorRef.current.x = t.clientX;\r\n      cursorRef.current.y = t.clientY;\r\n    };\r\n\r\n    window.addEventListener(\"mousemove\", onMouseMove);\r\n    window.addEventListener(\"touchmove\", onTouchMove, { passive: true });\r\n\r\n    if (containerRef.current) {\r\n      const rect = containerRef.current.getBoundingClientRect();\r\n      mouseRef.current = {\r\n        x: rect.left + rect.width / 2,\r\n        y: rect.top + rect.height / 2,\r\n      };\r\n      cursorRef.current = { ...mouseRef.current };\r\n    }\r\n\r\n    return () => {\r\n      window.removeEventListener(\"mousemove\", onMouseMove);\r\n      window.removeEventListener(\"touchmove\", onTouchMove);\r\n    };\r\n  }, [mounted]);\r\n\r\n  /* ------------------------------ RESIZE ---------------------------------- */\r\n\r\n  const setSize = useCallback(() => {\r\n    if (!containerRef.current || !titleRef.current) return;\r\n\r\n    const { width: cw, height: ch } =\r\n      containerRef.current.getBoundingClientRect();\r\n\r\n    let nextFontSize = cw / (chars.length / 2);\r\n    nextFontSize = Math.max(nextFontSize, minFontSize);\r\n\r\n    setFontSize(nextFontSize);\r\n    setScaleY(1);\r\n    setLineHeight(1);\r\n\r\n    requestAnimationFrame(() => {\r\n      if (!titleRef.current) return;\r\n      const textRect = titleRef.current.getBoundingClientRect();\r\n\r\n      if (scale && textRect.height > 0) {\r\n        const yRatio = ch / textRect.height;\r\n        setScaleY(yRatio);\r\n        setLineHeight(yRatio);\r\n      }\r\n    });\r\n  }, [chars.length, minFontSize, scale]);\r\n\r\n  useEffect(() => {\r\n    if (!mounted) return;\r\n\r\n    const onResize = debounce(setSize, 100);\r\n    onResize();\r\n    window.addEventListener(\"resize\", onResize);\r\n    return () => window.removeEventListener(\"resize\", onResize);\r\n  }, [mounted, setSize]);\r\n\r\n  /* ------------------------------ ANIMATION ------------------------------- */\r\n\r\n  useEffect(() => {\r\n    if (!mounted) return;\r\n\r\n    let rafId = 0;\r\n\r\n    const animate = () => {\r\n      mouseRef.current.x += (cursorRef.current.x - mouseRef.current.x) / 15;\r\n      mouseRef.current.y += (cursorRef.current.y - mouseRef.current.y) / 15;\r\n\r\n      if (titleRef.current) {\r\n        const titleRect = titleRef.current.getBoundingClientRect();\r\n        const maxDist = titleRect.width / 2;\r\n\r\n        spansRef.current.forEach((span) => {\r\n          if (!span) return;\r\n\r\n          const rect = span.getBoundingClientRect();\r\n          const center: Vec2 = {\r\n            x: rect.x + rect.width / 2,\r\n            y: rect.y + rect.height / 2,\r\n          };\r\n\r\n          const d = dist(mouseRef.current, center);\r\n\r\n          const wdth = width ? Math.floor(getAttr(d, maxDist, 5, 200)) : 100;\r\n          const wght = weight ? Math.floor(getAttr(d, maxDist, 100, 900)) : 400;\r\n          const ital = italic ? getAttr(d, maxDist, 0, 1).toFixed(2) : \"0\";\r\n          const a = alpha ? getAttr(d, maxDist, 0, 1).toFixed(2) : \"1\";\r\n\r\n          span.style.fontVariationSettings = `'wght' ${wght}, 'wdth' ${wdth}, 'ital' ${ital}`;\r\n          if (alpha) span.style.opacity = a;\r\n        });\r\n      }\r\n\r\n      rafId = requestAnimationFrame(animate);\r\n    };\r\n\r\n    animate();\r\n    return () => cancelAnimationFrame(rafId);\r\n  }, [mounted, width, weight, italic, alpha]);\r\n\r\n  /* ------------------------------ STYLES ---------------------------------- */\r\n\r\n  const styleElement = useMemo(() => {\r\n    if (!mounted) return null;\r\n\r\n    return (\r\n      <style>{`\r\n        @font-face {\r\n          font-family: '${fontFamily}';\r\n          src: url('${fontUrl}');\r\n          font-style: normal;\r\n        }\r\n\r\n        .pressure-test-title span {\r\n          display: inline-block;\r\n          transform-origin: center center;\r\n        }\r\n\r\n        .stroke span {\r\n          position: relative;\r\n          color: ${textColor || \"inherit\"};\r\n        }\r\n\r\n        .stroke span::after {\r\n          content: attr(data-char);\r\n          position: absolute;\r\n          inset: 0;\r\n          color: transparent;\r\n          z-index: -1;\r\n          -webkit-text-stroke-width: ${strokeWidth}px;\r\n          -webkit-text-stroke-color: ${strokeColor || \"currentColor\"};\r\n        }\r\n      `}</style>\r\n    );\r\n  }, [mounted, fontFamily, fontUrl, textColor, strokeColor, strokeWidth]);\r\n\r\n  /* ------------------------------ RENDER ---------------------------------- */\r\n\r\n  // ðŸ”¥ HARD GATE â€” NOTHING RENDERS ON SERVER\r\n  if (!mounted) {\r\n    return <div className=\"relative w-full h-full\" aria-hidden=\"true\" />;\r\n  }\r\n\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      className=\"relative w-full h-full bg-transparent flex items-center justify-center\"\r\n    >\r\n      {styleElement}\r\n\r\n      <h1\r\n        ref={titleRef}\r\n        className={`pressure-test-title ${className} ${flex ? \"flex w-full\" : \"\"\r\n          } ${stroke ? \"stroke\" : \"\"} uppercase text-center`}\r\n        style={{\r\n          fontFamily,\r\n          fontSize,\r\n          lineHeight,\r\n          transform: `scale(1, ${scaleY})`,\r\n          transformOrigin: \"center top\",\r\n          margin: 0,\r\n          fontWeight: 100,\r\n          color: textColor,\r\n          whiteSpace: \"nowrap\",\r\n          width: \"100%\",\r\n          justifyContent: justify === \"between\" ? \"space-between\" : justify === \"center\" ? \"center\" : justify === \"end\" ? \"flex-end\" : \"flex-start\",\r\n        }}\r\n      >\r\n        {chars.map((char, i) => (\r\n          <span\r\n            key={i}\r\n            ref={(el) => {\r\n              spansRef.current[i] = el;\r\n            }}\r\n            data-char={char}\r\n          >\r\n            {char}\r\n          </span>\r\n        ))}\r\n      </h1>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PressureTest;\r\n"
    }
  ]
}